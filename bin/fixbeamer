#!/usr/bin/perl

use strict;
use warnings;

my $text = do { local $/; <STDIN> };

$text =~ s# ^(\\subsection[^\n]+) #\\end{frame}\n$1\n\\begin{frame}[fragile]\n#xmsg;
$text =~ s# ^(\\end\{frame\}\n)   ##xms;
$text =~ s# ^(\\end\{document\})  #\\end{frame}\n$1#xms;

print $text;
